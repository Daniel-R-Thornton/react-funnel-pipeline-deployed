{"version":3,"file":"index.js","sources":["../src/FunnelChart.tsx"],"sourcesContent":["import * as React from 'react'\nimport './index.css'\n\ninterface IFunnelChartProps {\n  data: any\n  title?: string\n  showValues: boolean\n  showNames: boolean\n  pallette: string[]\n  showRunningTotal: boolean\n  heightRelativeToValue: boolean\n  chartHeight?: number\n  chartWidth?: number\n  style?: React.CSSProperties\n  funnelShape?: 'standard' | 'flat'\n  getRowStyle?: (row: any) => React.CSSProperties\n  getRowNameStyle?: (row: any) => React.CSSProperties\n  getRowValueStyle?: (row: any) => React.CSSProperties\n  getTitleStyle?: (title: any) => React.CSSProperties\n  decorateValue?: (row: any, index: number, data: any) => any\n  getToolTip?: (row: any) => string\n  onRowClick?: (row: any) => void\n}\n\ninterface IFunnelChartState {}\n\nconst initialState: IFunnelChartState = {}\n\nclass FunnelChart extends React.Component<\n  IFunnelChartProps,\n  IFunnelChartState\n> {\n  static defaultProps = {\n    showValues: true,\n    showNames: true,\n    pallette: [\n      '#f14c14',\n      '#f39c35',\n      '#68BC00',\n      '#1d7b63',\n      '#4e97a8',\n      '#4466a3'\n    ],\n    showRunningTotal: false,\n    heightRelativeToValue: false,\n    funnelShape: 'standard'\n  }\n\n  constructor(props: IFunnelChartProps) {\n    super(props)\n    this.state = initialState\n  }\n\n  setFunnelRows() {\n    const {\n      data,\n      showNames,\n      showValues,\n      showRunningTotal,\n      heightRelativeToValue,\n      chartHeight,\n      getRowStyle,\n      getRowNameStyle,\n      getRowValueStyle,\n      decorateValue,\n      getToolTip,\n      onRowClick\n    } = this.props\n    const rows = []\n    const totalValue = this.getTotalValue()\n\n    let sizePerValue = 0\n    if (heightRelativeToValue && totalValue > 0) {\n      let totalHeight = chartHeight\n      if (!totalHeight) {\n        totalHeight = 500\n        if (window.innerWidth < 500) {\n          totalHeight = 300\n        }\n      }\n      sizePerValue = totalHeight / totalValue\n    }\n\n    var runningTotal = totalValue\n    if (data) {\n      for (var i1 = 0; i1 < data.length; i1++) {\n        const thisRow = data[i1]\n        let showTitle = true\n        let showValue = true\n\n        if (thisRow.value >= 0) {\n          let rowStyle: React.CSSProperties = {}\n          let rowTitleStyle: React.CSSProperties = {}\n          let rowValueStyle: React.CSSProperties = {}\n          const decoratedValue =\n            typeof decorateValue === 'function'\n              ? decorateValue(thisRow, i1, data)\n              : thisRow.value\n\n          if (typeof getRowStyle === 'function') {\n            rowStyle = getRowStyle(thisRow)\n          }\n          if (typeof getRowNameStyle === 'function') {\n            rowTitleStyle = getRowNameStyle(thisRow)\n          }\n          if (typeof getRowValueStyle === 'function') {\n            rowValueStyle = getRowValueStyle(thisRow)\n          }\n\n          if (heightRelativeToValue) {\n            const size = sizePerValue * thisRow.value\n            rowStyle.height = size + 'px'\n            rowStyle.maxHeight = size + 'px'\n            if (size < 65) {\n              showValue = false\n            }\n            if (size < 40) {\n              showTitle = false\n            }\n          }\n          if (thisRow.backgroundColor) {\n            rowStyle.backgroundColor = thisRow.backgroundColor\n          }\n          if (!rowStyle.backgroundColor) {\n            rowStyle.backgroundColor =\n              this.props.pallette[i1 % this.props.pallette.length]\n          }\n\n          if (!showNames) {\n            showTitle = false\n          }\n          if (!showValues) {\n            showValue = false\n          }\n\n          let toolTip = thisRow.name + '\\n' + runningTotal\n          if (typeof getToolTip === 'function') {\n            toolTip = getToolTip(thisRow)\n          }\n\n          if (typeof onRowClick === 'function') {\n            rowStyle.cursor = 'pointer'\n          }\n\n          rows.push(\n            <div\n              key={'funnel-pipeline-chart-row-' + thisRow.name}\n              className='funnel-pipeline-chart-row'\n              style={rowStyle}\n              title={toolTip}\n              onClick={\n                typeof onRowClick === 'function'\n                  ? () => onRowClick(thisRow)\n                  : undefined\n              }\n            >\n              <div>\n                {showTitle ? (\n                  <div\n                    className='funnel-pipeline-chart-title'\n                    style={rowTitleStyle}\n                  >\n                    {thisRow.name}\n                  </div>\n                ) : null}\n                {showValue ? (\n                  <div\n                    className='funnel-pipeline-chart-value'\n                    style={rowValueStyle}\n                  >\n                    {showRunningTotal ? runningTotal : decoratedValue}\n                  </div>\n                ) : null}\n              </div>\n            </div>\n          )\n        }\n\n        runningTotal = runningTotal - thisRow.value\n      }\n    }\n\n    return rows\n  }\n\n  getTotalValue() {\n    const { data } = this.props\n\n    let dataTotal = 0\n    if (data) {\n      for (var i1 = 0; i1 < data.length; i1++) {\n        dataTotal += data[i1].value\n      }\n    }\n\n    return dataTotal\n  }\n\n  render() {\n    const { title, style, funnelShape, getTitleStyle } = this.props\n\n    let titleStyle: React.CSSProperties = { marginBottom: '30px' }\n\n    if (typeof getTitleStyle === 'function') {\n      titleStyle = getTitleStyle(title)\n    }\n\n    const funnelShapeClassName =\n      funnelShape === 'flat'\n        ? 'funnel-pipeline-chart-flat'\n        : 'funnel-pipeline-chart'\n\n    const chartStyles: React.CSSProperties = {}\n    if (style) {\n      Object.assign(chartStyles, style)\n    }\n    if (this.props.chartWidth) {\n      chartStyles.maxWidth = this.props.chartWidth\n    }\n\n    return (\n      <div className={funnelShapeClassName} style={chartStyles}>\n        {title ? <h2 style={titleStyle}>{title}</h2> : null}\n        {this.setFunnelRows()}\n      </div>\n    )\n  }\n}\n\nexport default FunnelChart\n"],"names":["initialState","FunnelChart","_React$Component","_inheritsLoose","props","_this","call","state","_proto","prototype","setFunnelRows","_this$props","data","showNames","showValues","showRunningTotal","heightRelativeToValue","chartHeight","getRowStyle","getRowNameStyle","getRowValueStyle","decorateValue","getToolTip","onRowClick","rows","totalValue","getTotalValue","sizePerValue","totalHeight","window","innerWidth","runningTotal","_loop","thisRow","i1","showTitle","showValue","value","rowStyle","rowTitleStyle","rowValueStyle","decoratedValue","size","height","maxHeight","backgroundColor","_this2","pallette","length","toolTip","name","cursor","push","React","key","className","style","title","onClick","undefined","dataTotal","render","_this$props2","funnelShape","getTitleStyle","titleStyle","marginBottom","funnelShapeClassName","chartStyles","Object","assign","chartWidth","maxWidth"],"mappings":"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"}